openapi: 3.0.3
info:
  title: Shopping Cart API
  description: |
    API for managing shopping carts. A cart is represented as an Order with status='new'.
    Supports add, update, remove, and clear operations for cart line items.
  version: 1.0.0
  contact:
    name: eCommerce SaaS API Team
    email: api@ecommerce-saas.com

servers:
  - url: http://localhost:5173/api/v1
    description: Development server with MSW mocks
  - url: https://api.ecommerce-saas.com/api/v1
    description: Production server (future)

tags:
  - name: Cart
    description: Shopping cart operations

paths:
  /cart:
    get:
      summary: Get current cart
      description: |
        Retrieves the active cart (Order with status='new') for the authenticated user.
        If no active cart exists, returns an empty cart structure.
      operationId: getCart
      tags:
        - Cart
      parameters:
        - $ref: '#/components/parameters/TenantIdHeader'
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Cart retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
              examples:
                activeCart:
                  summary: Cart with items
                  value:
                    id: cart-123e4567-e89b-12d3-a456-426614174000
                    tenantId: demo-tenant
                    marketId: market-1
                    orderNumber: DEMO-000001
                    status: new
                    subtotal: 89.97
                    tax: 0
                    shipping: 0
                    discount: 0
                    total: 89.97
                    currency: USD
                    createdAt: '2025-10-22T10:00:00Z'
                    updatedAt: '2025-10-22T10:15:00Z'
                    lineItems:
                      - id: item-1
                        orderId: cart-123e4567-e89b-12d3-a456-426614174000
                        productId: prod-001
                        productName: Wireless Mouse
                        productSKU: WM-001
                        productImage: https://example.com/images/mouse.jpg
                        quantity: 2
                        unitPrice: 29.99
                        lineTotal: 59.98
                        currency: USD
                      - id: item-2
                        orderId: cart-123e4567-e89b-12d3-a456-426614174000
                        productId: prod-002
                        productName: USB Keyboard
                        productSKU: KB-002
                        productImage: https://example.com/images/keyboard.jpg
                        quantity: 1
                        unitPrice: 29.99
                        lineTotal: 29.99
                        currency: USD
                emptyCart:
                  summary: Empty cart
                  value:
                    id: cart-new
                    tenantId: demo-tenant
                    marketId: market-1
                    status: new
                    subtotal: 0
                    tax: 0
                    shipping: 0
                    discount: 0
                    total: 0
                    currency: USD
                    createdAt: '2025-10-22T10:00:00Z'
                    updatedAt: '2025-10-22T10:00:00Z'
                    lineItems: []
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Clear all items from cart
      description: Removes all line items from the cart. Cart structure remains but lineItems array is empty.
      operationId: clearCart
      tags:
        - Cart
      parameters:
        - $ref: '#/components/parameters/TenantIdHeader'
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Cart cleared successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
              example:
                id: cart-123e4567-e89b-12d3-a456-426614174000
                tenantId: demo-tenant
                marketId: market-1
                status: new
                subtotal: 0
                tax: 0
                shipping: 0
                discount: 0
                total: 0
                currency: USD
                createdAt: '2025-10-22T10:00:00Z'
                updatedAt: '2025-10-22T10:30:00Z'
                lineItems: []
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /cart/items:
    post:
      summary: Add product to cart
      description: |
        Adds a product to the cart with the specified quantity.
        If the product already exists in cart, increases the quantity.
        Creates a new cart if one doesn't exist.
      operationId: addToCart
      tags:
        - Cart
      parameters:
        - $ref: '#/components/parameters/TenantIdHeader'
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddToCartRequest'
            example:
              productId: prod-001
              quantity: 2
      responses:
        '200':
          description: Product added to cart successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Invalid request (invalid quantity, missing productId)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: Bad Request
                message: Quantity must be at least 1
                statusCode: 400
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: Not Found
                message: Product with ID prod-999 not found
                statusCode: 404
        '409':
          description: Product out of stock
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: Conflict
                message: Product 'Wireless Mouse' is out of stock
                statusCode: 409
                details:
                  productId: prod-001
                  availableQuantity: 0
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /cart/items/{lineItemId}:
    put:
      summary: Update cart item quantity
      description: Updates the quantity of an existing cart item. Use quantity=0 to remove the item, or use DELETE endpoint.
      operationId: updateCartItem
      tags:
        - Cart
      parameters:
        - $ref: '#/components/parameters/TenantIdHeader'
        - name: lineItemId
          in: path
          required: true
          description: Unique identifier of the cart line item
          schema:
            type: string
            format: uuid
          example: item-123e4567-e89b-12d3-a456-426614174000
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCartItemRequest'
            example:
              quantity: 5
      responses:
        '200':
          description: Cart item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Invalid quantity
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: Bad Request
                message: Quantity must be between 1 and 999
                statusCode: 400
        '404':
          description: Line item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: Not Found
                message: Cart item with ID item-999 not found
                statusCode: 404
        '409':
          description: Requested quantity exceeds available stock
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: Conflict
                message: Only 3 units available for product 'Wireless Mouse'
                statusCode: 409
                details:
                  productId: prod-001
                  requestedQuantity: 10
                  availableQuantity: 3
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

    delete:
      summary: Remove item from cart
      description: Removes a specific line item from the cart.
      operationId: removeCartItem
      tags:
        - Cart
      parameters:
        - $ref: '#/components/parameters/TenantIdHeader'
        - name: lineItemId
          in: path
          required: true
          description: Unique identifier of the cart line item
          schema:
            type: string
            format: uuid
          example: item-123e4567-e89b-12d3-a456-426614174000
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Item removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '404':
          description: Line item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: Not Found
                message: Cart item with ID item-999 not found
                statusCode: 404
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for authenticated requests

  parameters:
    TenantIdHeader:
      name: X-Tenant-ID
      in: header
      required: true
      description: Unique identifier for the tenant
      schema:
        type: string
        format: uuid
      example: demo-tenant

  schemas:
    Order:
      type: object
      description: Order entity representing a cart or submitted order
      required:
        - id
        - tenantId
        - marketId
        - status
        - subtotal
        - tax
        - shipping
        - discount
        - total
        - currency
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique order identifier
          example: cart-123e4567-e89b-12d3-a456-426614174000
        tenantId:
          type: string
          description: Tenant identifier
          example: demo-tenant
        marketId:
          type: string
          description: Market identifier
          example: market-1
        orderNumber:
          type: string
          description: Human-readable order number
          example: DEMO-000001
        status:
          $ref: '#/components/schemas/OrderStatus'
        subtotal:
          type: number
          format: double
          description: Sum of all line item totals (before tax/shipping)
          minimum: 0
          example: 89.97
        tax:
          type: number
          format: double
          description: Tax amount
          minimum: 0
          example: 0
        shipping:
          type: number
          format: double
          description: Shipping cost
          minimum: 0
          example: 0
        discount:
          type: number
          format: double
          description: Discount amount
          minimum: 0
          example: 0
        total:
          type: number
          format: double
          description: Final total (subtotal + tax + shipping - discount)
          minimum: 0
          example: 89.97
        currency:
          type: string
          description: ISO 4217 currency code
          pattern: '^[A-Z]{3}$'
          example: USD
        createdAt:
          type: string
          format: date-time
          description: When order was created
          example: '2025-10-22T10:00:00Z'
        updatedAt:
          type: string
          format: date-time
          description: When order was last updated
          example: '2025-10-22T10:15:00Z'
        lineItems:
          type: array
          description: Line items in the order
          items:
            $ref: '#/components/schemas/OrderLineItem'
        metadata:
          type: object
          description: Additional order metadata
          additionalProperties: true

    OrderLineItem:
      type: object
      description: Single product entry in an order
      required:
        - id
        - orderId
        - productId
        - productName
        - productSKU
        - quantity
        - unitPrice
        - lineTotal
        - currency
      properties:
        id:
          type: string
          format: uuid
          description: Unique line item identifier
          example: item-123e4567-e89b-12d3-a456-426614174000
        orderId:
          type: string
          format: uuid
          description: Parent order identifier
          example: cart-123e4567-e89b-12d3-a456-426614174000
        productId:
          type: string
          format: uuid
          description: Product identifier
          example: prod-001
        productName:
          type: string
          description: Product name (snapshot)
          maxLength: 200
          example: Wireless Mouse
        productSKU:
          type: string
          description: Product SKU (snapshot)
          maxLength: 100
          example: WM-001
        productImage:
          type: string
          format: uri
          description: Product image URL (snapshot)
          example: https://example.com/images/mouse.jpg
        quantity:
          type: integer
          description: Quantity ordered
          minimum: 1
          maximum: 999
          example: 2
        unitPrice:
          type: number
          format: double
          description: Price per unit (snapshot)
          minimum: 0
          example: 29.99
        lineTotal:
          type: number
          format: double
          description: Total for this line (quantity Ã— unitPrice)
          minimum: 0
          example: 59.98
        currency:
          type: string
          description: ISO 4217 currency code
          pattern: '^[A-Z]{3}$'
          example: USD
        metadata:
          type: object
          description: Additional line item data
          additionalProperties: true

    OrderStatus:
      type: string
      description: Order status lifecycle stage
      enum:
        - new
        - submitted
        - paid
        - completed
        - cancelled
      example: new

    AddToCartRequest:
      type: object
      description: Request to add product to cart
      required:
        - productId
        - quantity
      properties:
        productId:
          type: string
          format: uuid
          description: Product to add to cart
          example: prod-001
        quantity:
          type: integer
          description: Quantity to add
          minimum: 1
          maximum: 999
          example: 2

    UpdateCartItemRequest:
      type: object
      description: Request to update cart item quantity
      required:
        - quantity
      properties:
        quantity:
          type: integer
          description: New quantity (0 to remove item)
          minimum: 0
          maximum: 999
          example: 5

    ErrorResponse:
      type: object
      description: Standard error response
      required:
        - error
        - message
        - statusCode
      properties:
        error:
          type: string
          description: Error type
          example: Bad Request
        message:
          type: string
          description: Human-readable error message
          example: Quantity must be at least 1
        statusCode:
          type: integer
          description: HTTP status code
          example: 400
        details:
          type: object
          description: Additional error details
          additionalProperties: true

  responses:
    UnauthorizedError:
      description: Authentication required or token invalid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: Unauthorized
            message: Authentication token is missing or invalid
            statusCode: 401

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: Internal Server Error
            message: An unexpected error occurred
            statusCode: 500

security:
  - bearerAuth: []
